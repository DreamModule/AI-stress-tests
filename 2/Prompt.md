Ты выступаешь в роли Главного Архитектора Систем (Grandmaster of Systems Engineering) с докторской степенью в области теоретической физики и прикладной математики. Твоя задача — спроектировать и реализовать на C++23 ядро симуляции Релятивистской Квантовой Хромодинамики (n-Body Relativistic QCD) в искривленном пространстве-времени Минковского.
Техническое задание:
1. Математический аппарат и Физика:
Реализуй расчет траекторий частиц с учетом преобразований Лоренца и метрики Минковского. Каждая частица обладает тензором энергии-импульса.
Используй Симплектический интегратор 4-го порядка (Integrator of Ruth) для решения системы дифференциальных уравнений движения.
Добавь расчет квантовой вероятности взаимодействия через аппроксимацию потенциала Юкавы, используя экспоненциальное затухание в высокоразмерном пространстве.
2. Архитектура данных (Extreme DoD):
Используй SoA (Structure of Arrays), упакованный в блоки, выровненные по L3-cache line (64 или 128 байт).
Реализуй BVH (Bounding Volume Hierarchy) на основе 64-битных кодов Мортона для пространственного разбиения. Все вычисления кодов Мортона должны происходить на этапе компиляции или через SIMD-интринсики.
3. Низкоуровневая оптимизация (Hardware-Aware):
Весь горячий цикл обновления должен быть написан с использованием AVX-512 интринсиков (или AVX2 с ручной распаковкой).
Реализуй кастомный Wait-Free MPMC (Multi-Producer Multi-Consumer) Ring Buffer для системы логирования событий, используя std::atomic с явным указанием std::memory_order_acquire/release и std::memory_order_consume.
Предусмотри защиту от False Sharing, используя alignas(std::hardware_destructive_interference_size).
4. Метапрограммирование (Compile-time Magic):
Используй C++23 Concepts для валидации физических единиц измерения (Unit Analysis) на этапе компиляции (размерность массы, времени, заряда).
Реализуй автоматическую генерацию SIMD-масок через вариативные шаблоны (variadic templates) в зависимости от архитектуры целевого процессора.
5. Ограничения:
Zero Heap Allocation в основном цикле. Вся память должна быть преаллоцирована через Huge Pages (2MB/1GB).
Запрещено использование std::mutex, std::function, std::shared_ptr и виртуальных таблиц (vtable).
Код должен быть устойчив к Memory Reordering на архитектурах с расслабленной моделью памяти (ARM/PowerPC).
Формат ответа:
Архитектурный чертеж: Краткое описание математической модели и того, как ты решаешь проблему когерентности кэша.
Код: Полная реализация в одном файле.
Proof of Correctness: Объясни, как реализованная тобой схема синхронизации предотвращает ABA-проблему в MPMC буфере и почему выбранный интегратор сохраняет гамильтониан системы.
